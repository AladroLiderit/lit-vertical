<?xml version="1.0"?>
<openerp>
	<data>

        <record id="asincar_custom_project_form" model="ir.ui.view">
            <field name="name">asincar.custom.project.form</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project_department.edit_project"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='department_id']" position="replace"/>

                <xpath expr="//field[@name='partner_id']" position="replace"/>

                <xpath expr="//group[@name='group_alias']" position="before">
                    <group col="8" colspan="4">
                        <field name="department_id" colspan="4"/>
                        <field name="project_year"/>
                        <field name="project_convoc"/>
                    </group>
                    <group col="6" colspan="4">
                        <field name="project_type" colspan="2"/>
                        <field name="linea_trabajo" colspan="4"/>
                    </group>
                </xpath>

            </field>
        </record>



        <record id="asincar_custom_task_form" model="ir.ui.view">
            <field name="name">asincar.custom.task.form</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='date_start']" position="replace"/>

                <xpath expr="//field[@name='date_end']" position="replace"/>

                <xpath expr="//field[@name='date_deadline']" position="before">
                        <field name="date_start"/>
                        <field name="date_end"/>
                        <field name="date_closed"/>
                </xpath>
                <xpath expr="//field[@name='project_id']" position="after">
                        <field name="perfil_id"/>
                        <field name="user_ids" widget="many2many"/>
                </xpath>
                <xpath expr="//field[@name='user_id']" position="replace"/>
                <xpath expr="//field[@name='planned_hours']" position="replace"/>
                <xpath expr="//field[@name='progress']" position="before">
                        <field name="planned_hours"/>
                        <field name="planned_cost"/>
                </xpath>

            </field>
        </record>

        <record id="asincar_custom_timesheet_task_tree" model="ir.ui.view">
            <field name="name">asincar.custom.timesheet.task.tree</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="timesheet_task.view_task_form2"/>
            <field name="arch" type="xml">
                <xpath expr="//tree[@string='Task Work']/field[@name='amount']" position="attributes">
                    <attribute name="invisible">0</attribute>
                    <!--queda saber permisos para ver este valor-->
                    <attribute name="groups">asincar_security.group_asincar2_admin</attribute>
                </xpath>
                <xpath expr="//form[@string='Task Work']/field[@name='amount']" position="attributes">
                    <attribute name="invisible">0</attribute>
                    <attribute name="groups">asincar_security.group_asincar2_admin</attribute>
                </xpath>
                
                <xpath expr="//tree[@string='Task Work']/field[@name='user_id']" position="attributes">
                    <attribute name="invisible">0</attribute>
                    <attribute name="groups">asincar_security.group_asincar2_admin</attribute>
                </xpath>
                <xpath expr="//form[@string='Task Work']/field[@name='user_id']" position="attributes">
                    <attribute name="invisible">0</attribute>
                    <attribute name="groups">asincar_security.group_asincar2_admin</attribute>
                </xpath>

            </field>
        </record>

        <record id="asincar_timesheet_task_tree" model="ir.ui.view">
            <field name="name">asincar.timesheet.task.tree</field>
            <field name="model">hr.analytic.timesheet</field>
            <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='amount']" position="attributes">
                    <!--queda saber permisos para ver este valor-->
                    <attribute name="groups">asincar_security.group_asincar2_admin</attribute>
                    <attribute name="invisible">0</attribute>
                </xpath>
                <xpath expr="//field[@name='user_id']" position="attributes">
                    <!--queda saber permisos para ver este valor-->
                    <attribute name="groups">asincar_security.group_asincar2_admin</attribute>
                    <attribute name="invisible">0</attribute>
                </xpath>

            </field>
        </record>



        <record id="asincar_project_partnerids" model="ir.ui.view">
            <field name="name">asincar.project.partnerids.form</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='analytic_account_id']" position="after">
                    <group col="6">
                        <div class="project-code">
                            <field name="project_code" colspan ="4" readonly="True" />
                        </div>
                        <field name="sequence_id" colspan="2" required="True"/>     
                    </group>
                </xpath>

                <page string="Other Info" position="before">
                    <page string="Clientes">
                        <field colspan="4" name="partner_ids" widget="many2many_kanban" context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'project.group_project_user']}">
                            <kanban quick_create="false" create="true" delete="true">
                                <field name="name"/>
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div style="position: relative">
                                                <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 0; padding: 4px; diplay: inline-block">X</a>
                                                <div class="oe_module_vignette">
                                                    <img t-att-src="kanban_image('res.users', 'image_small', record.id.value)" class="oe_avatar oe_kanban_avatar_smallbox"/>
                                                    <div class="oe_module_desc">
                                                        <field name="name"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                            </kanban>
                        </field>
                    </page>

                    <page string="Plan Financiero" groups="asincar_security.group_asincar2_admin">
                        <group name="plan_financiero" col="6" colspan="4">
                            <group name="income" col="2" colspan="2">
                                <field name="public_planned_income"/>
                                <field name="invoice_planned_income"/>
                                <field name="planned_income" readonly= "True"/>
                            </group>
                            <group name="costs" col="2" colspan="2">
                                <field name="planned_total_cost" readonly="True"/>
                                <field name="planned_product"/>
                                <field name="planned_waste"/>
                                <field name="planned_indirect"/>
                                <field name="planned_cost" readonly="True"/>
                            </group>
                            <group name="result" col="2" colspan="2">
                                <field name="planned_result" readonly="True"/>
                            </group>
                        </group>
                    </page>

                </page>

            </field>
        </record>

        <record id="view_project_asincar_filter" model="ir.ui.view">
          <field name="name">project.asincar.select</field>
          <field name="model">project.project</field>
          <field name="inherit_id" ref="project.view_project_project_filter" />
          <field name="arch" type="xml">
            <xpath expr="/search/field[@name='partner_id']" position="before">
              <field name="project_convoc"/>
              <field name="linea_trabajo"/>
            </xpath>
            <xpath expr="/search/group/filter[@string='Manager']" position="after">
              <filter string="Convocatoria" icon="terp-folder-orange" domain="[]" context="{'group_by':'project_convoc'}"/>
            </xpath>
          </field>
        </record>

        <record id="project_kanban_asincar_form" model="ir.ui.view">
            <field name="name">project.kanban.asincar.form</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.view_project_kanban"/>
            <field name="arch" type="xml">
                <xpath expr="//kanban/field[@name='name']" position="before">
                    <field name="project_code"/>
                </xpath>

                <xpath expr="//kanban/templates//div//div/h4" position="before">
                    <h3 class="text-center"><strong><field name="project_code"/></strong></h3>
                </xpath>

                <xpath expr="//kanban/templates//div//div/div[@class='oe_kanban_project_avatars']" position="before">
                    <div class="oe_kanban_global_click">  
                    <field name="effective_hours" widget="gauge" style="width:120px;height:90px;cursor:pointer;" 
                           options="{'max_field': 'planned_hours'}"> 
                                   Avance                                
                    </field>                            
                </div>
                </xpath>

                <!--a t-if="record.use_tasks.raw_value" position="attributes">
                    <attribute name="type">edit</attribute>
                </a>
                <t t-raw="record.task_count.raw_value" position="replace">
                </t>
                <div class="oe_kanban_project_list" position="before">
                    <div class="oe_kanban_content">
                        <a t-if="record.use_tasks.raw_value" name="%(project.act_project_project_2_project_task_all)d" type="action" style="margin-right: 10px">
                            <t t-raw="record.task_count.raw_value"/> Tasks                                          
                        </a>
                    </div>
                </div-->
            </field>
        </record>

<!-- vistas para detalle de tareas por usuarios con menu propio-->
        <record id="view_task_userids_search" model="ir.ui.view">
            <field name="name">task.userids.search</field>
            <field name="model">task.by.users.id</field>
            <field name="arch" type="xml">
                <search string="Tareas por usuarios">
                    <field name="empleado" string="Empleado"/>
                    <field name="proyecto" string="Proyecto"/>
                    <field name="tarea" string="Tarea"/>
                    <!--field name="due_date_to" string="Hasta Fecha Límite" filter_domain="[('limite','&lt;=',self)]"/-->
                    <!--field name="due_date_from" string="Desde Fecha Límite" filter_domain="[('limite','&gt;=',self)]"/-->
                    <!--filter string="Año Actual" name="actual_year" 
                    domain="[('fecha_emision','&gt;=',(context_today().strftime('%%Y-01-01')))]"/-->
                    <filter string="En curso" name="en_curso" domain="[('finalizada','=',False)]"/>
                    <group expand='1' string='Group by...'>
                       <filter string='Empleado' name='empleado' icon="terp-stock_symbol-selection" 
                            domain="[]" context="{'group_by' : 'empleado'}" />
                       <filter string='Proyecto' name='proyecto' icon="terp-stock_symbol-selection" domain="[]" 
                            context="{'group_by' : 'proyecto'}" />
                       <filter string='Departamento' name='departamento' icon="terp-stock_symbol-selection" domain="[]" 
                            context="{'group_by' : 'departamento'}" />
                    </group>
                </search>
            </field>
        </record>

        <record id="view_task_userids_tree1" model="ir.ui.view">
            <field name="name">view.task.userids.tree1</field>
            <field name="model">task.by.users.id</field>
            <field name="priority">90</field>
            <field name="context">{'order':'limite desc'}</field>
            <field name="arch" type="xml">
                <tree string="Tareas por usuarios" editable="top">
                    <field name="tarea"/>
                    <field name="empleado"/>
                    <field name="proyecto"/>
                    <field name="departamento"/>
                    <field name="estado" invisible="1"/>
                    <field name="limite"/>
                    <field name="planificado" sum="Total planificado"/>
                    <field name="ejecutado"/>
                    <field name="pendiente" sum="Total pendiente"/>
                </tree>
            </field>
        </record>


        <record id="action_task_userids" model="ir.actions.act_window">
            <field name="name">Tareas por Usuario</field>
            <field name="res_model">task.by.users.id</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_task_userids_tree1"/>
            <field name="search_view_id" ref="view_task_userids_search"/>
        </record>

        <menuitem 
            action="action_task_userids" 
            id="menu_action_task_userids" 
            parent="project.menu_project_management" 
            name="Tareas por Usuario"
            sequence="60"/>



        <!--modifca vista de calendario de tareas para que las muestre sin tener fecha limite establecida-->
        <record model="ir.ui.view" id="asincar_task_calendar_view_inherit">
	        <field name="name">asincar.task.calendar</field>
	        <field name="model">project.task</field>
	        <field name="inherit_id" ref="project.view_task_calendar"/>
	        <field name="type">calendar</field>
	        <field name="arch" type="xml">
	        	<xpath expr="//calendar" position="replace">
			      <calendar color="project_id" date_start="date_start" date_delay="planned_hours" string="Tasks">
                    <field name="name"/>
                    <field name="project_id"/>
                    <field name="perfil_id"/>
                  </calendar>
			    </xpath>
	        </field>
	    </record>


        <!--modifica vistas de apuntes analíticos para introducir valor de tareas-->
        <record id="view_account_analytic_line_search_asincar" model="ir.ui.view">
            <field name="name">account.analytic.line.search.asincar</field>
            <field name="model">account.analytic.line</field>
            <field name="inherit_id" ref="account.view_account_analytic_line_filter"/>
            <field name="arch" type="xml">
                 <field name="account_id" position="after">
                     <field name="task_id" string="Tarea"/>
                 </field>
                 <filter string="Analytic Account" position="after">
                    <filter string="Tarea" context="{'group_by':'task_id'}"/>
                </filter>
            </field>
         </record>
        <record id="view_account_analytic_line_form_asincar" model="ir.ui.view">
            <field name="name">account.analytic.line.form.asincar</field>
            <field name="model">account.analytic.line</field>
            <field name="inherit_id" ref="account.view_account_analytic_line_form"/>
            <field name="arch" type="xml">
                <field name="account_id"  position="after">
                   <field name="task_id"/>
                </field>
            </field>
        </record>
       <record id="view_account_analytic_line_tree_asincar" model="ir.ui.view">
            <field name="name">account.analytic.line.tree.asincar</field>
            <field name="model">account.analytic.line</field>
            <field name="inherit_id" ref="account.view_account_analytic_line_tree"/>
            <field name="arch" type="xml">
                <field name="account_id"  position="after">
                    <field name="task_id"/>
                </field>
            </field>
        </record>


        <!-- poner el menu de apuntes analiticos en el apartado de proyectos también-->
        <menuitem 
            id="account.action_account_analytic_journal_open_form "
            parent="project.menu_project_management" 
            name="Apuntes de coste"
            groups="analytic.group_analytic_accounting"
            sequence="60"/>


	</data>
</openerp>
